DEFINE DYNAMIC TABLE DCM_PROJECT.ANALYTICS.MENU_ITEM_POPULARITY
  TARGET_LAG = '1 DAY'
  WAREHOUSE = DCM_PROJECT_WH
  INITIALIZE = ON_SCHEDULE
AS
  SELECT
    MENU_ITEM_NAME,
    ITEM_CATEGORY,
    COUNT(DISTINCT ORDER_ID) AS NUMBER_OF_ORDERS,
    SUM(QUANTITY) AS TOTAL_QUANTITY_SOLD,
    SUM(LINE_ITEM_REVENUE) AS TOTAL_REVENUE
  FROM
    DCM_PROJECT.ANALYTICS.ENRICHED_ORDER_DETAILS
  GROUP BY
    MENU_ITEM_NAME,
    ITEM_CATEGORY
  ORDER BY
    TOTAL_REVENUE DESC;
