rule: CV13

# Test SERIAL

test_fail_serial:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_serial4:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL4 PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_bigserial:
  fail_str: |
    CREATE TABLE my_table (
        id BIGSERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_serial8:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL8 PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_smallserial:
  fail_str: |
    CREATE TABLE my_table (
        id SMALLSERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_serial2:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL2 PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

# Test pass cases with GENERATED AS IDENTITY

test_pass_integer_identity:
  pass_str: |
    CREATE TABLE my_table (
        id INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_pass_bigint_identity:
  pass_str: |
    CREATE TABLE my_table (
        id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_pass_smallint_identity:
  pass_str: |
    CREATE TABLE my_table (
        id SMALLINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

# Test multiple columns with serial types

test_fail_multiple_serial_columns:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY,
        external_id BIGSERIAL,
        sequence_num SMALLSERIAL
    );
  configs:
    core:
      dialect: postgres

# Test non-PostgreSQL dialects should not flag (rule is PostgreSQL-specific)

test_pass_serial_mysql:
  pass_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: mysql

test_pass_serial_ansi:
  pass_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: ansi

# Test regular integer types (not serial)

test_pass_regular_integer:
  pass_str: |
    CREATE TABLE my_table (
        id INTEGER PRIMARY KEY,
        big_id BIGINT,
        small_id SMALLINT
    );
  configs:
    core:
      dialect: postgres

# Test case insensitivity

test_fail_serial_uppercase:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_serial_mixed_case:
  fail_str: |
    CREATE TABLE my_table (
        id Serial PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

# Test with other constraints and options

test_fail_serial_with_not_null:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL NOT NULL PRIMARY KEY
    );
  configs:
    core:
      dialect: postgres

test_fail_serial_with_default:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL DEFAULT 1
    );
  configs:
    core:
      dialect: postgres

# Test in alter table context

test_fail_add_column_serial:
  fail_str: |
    ALTER TABLE my_table
    ADD COLUMN new_id SERIAL;
  configs:
    core:
      dialect: postgres

# Redshift-specific tests

test_fail_serial_redshift:
  fail_str: |
    CREATE TABLE my_table (
        id SERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: redshift

test_fail_bigserial_redshift:
  fail_str: |
    CREATE TABLE my_table (
        id BIGSERIAL PRIMARY KEY
    );
  configs:
    core:
      dialect: redshift

test_pass_identity_redshift:
  pass_str: |
    CREATE TABLE my_table (
        id INTEGER IDENTITY(1, 1) PRIMARY KEY
    );
  configs:
    core:
      dialect: redshift

test_pass_bigint_identity_redshift:
  pass_str: |
    CREATE TABLE my_table (
        id BIGINT IDENTITY(1, 1) PRIMARY KEY
    );
  configs:
    core:
      dialect: redshift
